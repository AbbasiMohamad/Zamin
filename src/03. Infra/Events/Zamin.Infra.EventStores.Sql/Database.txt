Create Database EventStore
go
use EventStore
go

Create Table DomainEvents
(
Id bigint identity(1,1),
StreamName nvarchar(250),
StreamId nvarchar(250),
EventType nvarchar(250),
EventId nvarchar(250),
EventVersion bigint,
EventPayload nvarchar(max),
OccurDate Datetime,
OccurByUserId nvarchar(250),
Handled bit default(0)
)
go

Create Proc SProc_DomainEvents_Insert
@StreamName nvarchar(250),
@StreamId nvarchar(250),
@EventType nvarchar(250),
@EventId nvarchar(250),
@EventVersion bigint,
@EventPayload nvarchar(max),
@OccurDate Datetime,
@OccurByUserId nvarchar(250),
@Handled bit
as
Insert Into DomainEvents(StreamName,StreamId,EventType,EventId,EventVersion,EventPayload,OccurDate,OccurByUserId,Handled)
values(@StreamName,@StreamId,@EventType,@EventId,@EventVersion,@EventPayload,@OccurDate,@OccurByUserId,@Handled)
go

Create Proc SProc_DomainEvents_SelectVesion
@StreamName nvarchar(250),
@StreamId nvarchar(250)
as
select top 1 EventVersion  from DomainEvents where StreamName = @StreamName  and StreamId = @StreamId
order by Id desc
go